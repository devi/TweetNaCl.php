<?php

require "../TweetNaCl.php";

$alice_sk = array(
0xb1,0x99,0xe4,0x32,0xeb,0x45,0x59,0x0e,
0xab,0x40,0x54,0x93,0x07,0x38,0xbc,0xbe,
0x34,0xd5,0xc6,0x94,0xa7,0xe7,0xc0,0x43,
0xae,0xa2,0xa9,0x80,0xa0,0x94,0x59,0x1c
);

$bob_sk = array(
0xd8,0xa3,0x26,0x17,0x8d,0x98,0xcd,0xa5,
0x9f,0xff,0x28,0x1f,0x04,0x35,0x7c,0xbc,
0xe7,0x3c,0x98,0xdc,0x53,0x62,0x01,0x5f,
0x5a,0x8d,0x81,0x1a,0x73,0x24,0xac,0x6d
);

$nonce = array(
0x13,0x92,0x6a,0xbc,0x44,0xf1,0xe0,0x3c,
0x0b,0xf2,0xf9,0xef,0xe7,0x7a,0xc3,0xd4,
0x49,0x39,0xa0,0x90,0x57,0x9c,0x6d,0x0b
);

// API requires first 32 bytes to be 0
$msg = array(
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x54,0x68,0x65,0x20,0x63,0x72,0x79,0x70,
0x74,0x6f,0x5f,0x62,0x6f,0x78,0x20,0x66,
0x75,0x6e,0x63,0x74,0x69,0x6f,0x6e,0x20,
0x65,0x6e,0x63,0x72,0x79,0x70,0x74,0x73,
0x20,0x61,0x6e,0x64,0x20,0x61,0x75,0x74,
0x68,0x65,0x6e,0x74,0x69,0x63,0x61,0x74,
0x65,0x73,0x0a,0x61,0x20,0x6d,0x65,0x73,
0x73,0x61,0x67,0x65,0x20,0x6d,0x20,0x75,
0x73,0x69,0x6e,0x67,0x20,0x74,0x68,0x65,
0x20,0x73,0x65,0x6e,0x64,0x65,0x72,0x27,
0x73,0x20,0x73,0x65,0x63,0x72,0x65,0x74,
0x20,0x6b,0x65,0x79,0x20,0x73,0x6b,0x2c,
0x20,0x74,0x68,0x65,0x20,0x72,0x65,0x63,
0x65,0x69,0x76,0x65,0x72,0x27,0x73,0x20,
0x70,0x75,0x62,0x6c,0x69,0x63,0x20,0x6b,
0x65,0x79,0x0a,0x70,0x6b,0x2c,0x20,0x61,
0x6e,0x64,0x20,0x61,0x20,0x6e,0x6f,0x6e,
0x63,0x65,0x20,0x6e,0x2e
);

$alice_pk   = new SplFixedArray(32);
$bob_pk     = new SplFixedArray(32);
$mlen       = count($msg);
$chipertext = new SplFixedArray($mlen);
$plaintext  = new SplFixedArray($mlen);

$tweet = new TweetNaCl();

$time = -microtime(true);

// alice generate public key 
$tweet->crypto_scalarmult_base($alice_pk, $alice_sk);

// bob generate public key 
$tweet->crypto_scalarmult_base($bob_pk, $bob_sk);

// alice encrypt $msg
$tweet->crypto_box($chipertext, $msg, $mlen, $nonce, $bob_pk, $alice_sk);

// bob open $chipertext
$tweet->crypto_box_open($plaintext, $chipertext, $mlen, $nonce, $alice_pk, $bob_sk);

// bob read plain text
for ($i = 32;$i < $mlen;++$i) printf("%c", $plaintext[$i]); printf("\n");

$time += microtime(true);

printf("microtime: %f\n", $time);
printf("memory peak: %s\n", memory_get_peak_usage(true));
